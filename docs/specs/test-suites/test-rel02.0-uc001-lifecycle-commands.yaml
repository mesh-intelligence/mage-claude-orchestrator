# Copyright (c) 2026 Petar Djukic. All rights reserved.
# SPDX-License-Identifier: MIT

id: test-rel02.0-uc001-lifecycle-commands
title: VS Code lifecycle command execution

traces:
  - rel02.0-uc001-lifecycle-commands
  - prd006-vscode-extension R1

tags:
  - vscode
  - lifecycle
  - ui

preconditions:
  - VS Code with orchestrator extension installed
  - Workspace contains configuration.yaml
  - Git repository initialized with main branch
  - Beads initialized

test_cases:
  - name: Start command executes mage generator:start
    inputs:
      command: "Open Command Palette and select 'Mage Orchestrator: Start Generation'"
      state:
        current_branch: main
        generation_active: false
    expected:
      confirmation_shown: true
      terminal_command: "mage generator:start"
      state:
        current_branch: "generation-*"
        generation_active: true
        views_refreshed: true

  - name: Start command disabled when on generation branch
    inputs:
      state:
        current_branch: "generation-2026-02-19-10-00-00"
        generation_active: true
    expected:
      command_enabled: false
      reason: "Already on a generation branch"

  - name: Run command executes mage generator:run
    inputs:
      command: "Open Command Palette and select 'Mage Orchestrator: Run Generation'"
      state:
        current_branch: "generation-2026-02-19-10-00-00"
        generation_active: true
    expected:
      confirmation_shown: false
      terminal_command: "mage generator:run"
      state:
        views_refreshed: true

  - name: Resume command executes mage generator:resume
    inputs:
      command: "Open Command Palette and select 'Mage Orchestrator: Resume Generation'"
      state:
        current_branch: "generation-2026-02-19-10-00-00"
        generation_active: true
    expected:
      confirmation_shown: false
      terminal_command: "mage generator:resume"

  - name: Stop command shows confirmation before executing
    inputs:
      command: "Open Command Palette and select 'Mage Orchestrator: Stop Generation'"
      state:
        current_branch: "generation-2026-02-19-10-00-00"
        generation_active: true
    expected:
      confirmation_shown: true
      confirmation_message: "This will merge the generation into main. Continue?"
      terminal_command: "mage generator:stop"
      state:
        current_branch: main
        generation_active: false
        views_refreshed: true

  - name: Reset command shows confirmation before executing
    inputs:
      command: "Open Command Palette and select 'Mage Orchestrator: Reset Generation'"
      state:
        current_branch: "generation-2026-02-19-10-00-00"
        generation_active: true
    expected:
      confirmation_shown: true
      confirmation_message: "This will discard the generation. Continue?"
      terminal_command: "mage generator:reset"
      state:
        current_branch: main
        generation_active: false
        views_refreshed: true

  - name: Switch command shows generation picker
    inputs:
      command: "Open Command Palette and select 'Mage Orchestrator: Switch Generation'"
      state:
        current_branch: main
        available_generations:
          - generation-2026-02-19-10-00-00
          - generation-2026-02-18-14-30-00
    expected:
      quick_pick_shown: true
      quick_pick_items:
        - generation-2026-02-19-10-00-00
        - generation-2026-02-18-14-30-00
      terminal_command: "mage generator:switch"
      terminal_args:
        - generation-2026-02-19-10-00-00

  - name: Views refresh after command completion
    inputs:
      command: "Mage Orchestrator: Start Generation"
      state:
        git_refs_changed: true
    expected:
      generation_browser_refreshed: true
      issue_tracker_refreshed: true
      config_view_refreshed: false

  - name: Extension handles missing configuration.yaml
    inputs:
      state:
        configuration_yaml_exists: false
    expected:
      commands_enabled: false
      error_logged: "configuration.yaml not found in workspace"

cleanup:
  - Reset to main branch if on generation branch
  - Close all integrated terminals
